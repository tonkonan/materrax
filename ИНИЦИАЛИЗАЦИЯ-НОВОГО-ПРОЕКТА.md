# Инициализация нового проекта на базе @TGF

Этот гайд поможет быстро развернуть новый проект с той же архитектурой, что и в `@TGF`: тот же бэкенд (Node/Express + PostgreSQL), тот же фронтенд стек (Vue 3 + Vite), такая же структура директорий и процессы (dev/prod, сборка, nginx).

## 1) Структура каталогов проекта

```
project-name/
├── src/                      # Фронтенд (Vue 3, Vite)
│   ├── assets/               # Стили и ассеты
│   ├── components/           # Переиспользуемые UI-компоненты
│   ├── views/                # Страницы (SPA)
│   ├── router/               # Маршрутизация (Vue Router)
│   ├── store/                # Состояние (Vuex)
│   └── services/             # API-клиенты
├── public/                   # Публичные статики (favicon, картинки и т.п.)
├── dist/                     # Скомпилированный фронтенд (vite build) — генерируется
├── migrations/               # SQL-миграции PostgreSQL
├── logs/                     # Логи сервера (access.log, error.log) — создаются автоматически
├── docs/                     # Документация
├── index.html                # Корневой HTML для Vite
├── server.js                 # Express-сервер (API + отдача статики из dist)
├── package.json              # Скрипты и зависимости
├── vite.config.js            # Конфиг Vite (порт dev, proxy для /api)
├── .env                      # Переменные окружения (создать из .env.example)
└── README.md                 # Общее описание
```

Рекомендуется скопировать каркас `@TGF` в новую папку проекта, затем переименовать проект в `package.json` и пройти шаги ниже.

---

## 2) Предварительные требования

- Node.js 16+
- npm (или yarn/pnpm)
- PostgreSQL 13+

---

## 3) Установка зависимостей

```bash
npm install
# или для продакшена (строго по package-lock.json)
npm ci
```

---

## 4) Настройка окружения

### Переменные окружения

Создайте `.env` файл (можно скопировать из `.env.example` если есть):

```bash
# PostgreSQL
PGUSER=postgres
PGHOST=localhost
PGDATABASE=your_database_name
PGPASSWORD=your_password
PGPORT=5432

# Server
PORT=3000
NODE_ENV=development
```

В `server.js` подключение к PostgreSQL должно читать из переменных окружения:

```js
import 'dotenv/config'
// ...
const pool = new Pool({
  user: process.env.PGUSER || 'postgres',
  host: process.env.PGHOST || 'localhost',
  database: process.env.PGDATABASE || 'your_database',
  password: process.env.PGPASSWORD || 'your_password',
  port: process.env.PGPORT || 5432,
});
```

### Порты и скрипты

Скрипты в `package.json`:

```json
{
  "scripts": {
    "start": "npm run build && npm run server",
    "dev": "concurrently \"npm run server\" \"npm run client\"",
    "server": "nodemon server.js",
    "client": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

**Важно:**
- `npm start` — собирает фронтенд и запускает сервер (продакшен)
- `npm run dev` — запускает сервер + Vite dev-сервер параллельно (разработка)

В dev-режиме:
- Сервер: `PORT=3001` (по умолчанию 3000, но для dev лучше 3001)
- Vite: порт `5174` (настроен в `vite.config.js`)
- Vite проксирует `/api` на `http://localhost:3001`

```bash
# Dev режим
PORT=3001 npm run dev
# Фронтенд: http://localhost:5174
# API: проксируется через Vite на http://localhost:3001
```

---

## 5) Создание базы и применение миграций

Создайте базу данных:

```bash
createdb your_database_name
```

Примените миграции по порядку:

```bash
psql -d your_database_name -f migrations/001_initial_setup.sql
psql -d your_database_name -f migrations/002_next_migration.sql
# ... и так далее по порядку
```

При необходимости скорректируйте имя базы/пользователя и хост в `.env`.

---

## 6) Запуск

### Режим разработки

```bash
PORT=3001 npm run dev
```

- Фронтенд: `http://localhost:5174` (Vite dev-сервер с hot-reload)
- API: проксируется Vite на `http://localhost:3001`

### Продакшен

```bash
npm start
```

Это выполнит:
1. `npm run build` — сборка фронтенда в `dist/`
2. `npm run server` — запуск Express-сервера

Сервер будет доступен на `http://localhost:3000` (или порт из `PORT` в `.env`).

**Важно:** Сервер всегда отдаёт статику из `dist/` если она существует. Все не-API запросы идут на `index.html` (SPA fallback).

---

## 7) Nginx (reverse proxy, опционально)

Пример server-блока для продакшена:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    client_max_body_size 10m;
}
```

Перезагрузите nginx:

```bash
sudo nginx -t && sudo systemctl reload nginx
```

---

## 8) Где добавлять новый код

- **UI-компоненты**: `src/components/`
- **Страницы**: `src/views/` и маршруты в `src/router/index.js`
- **Стили**: `src/assets/css/` (глобальные в `main.css`)
- **API-клиентская логика**: `src/services/`
- **Vuex модули**: `src/store/modules/`
- **Бэкенд API**: `server.js` (добавлять роуты `/api/*`)
- **Миграции БД**: `migrations/` (нумеровать по порядку: `001_*.sql`, `002_*.sql`)

После добавления новых UI частей просто перезапустите dev-сервер (или обновите страницу) — Vite подхватит изменения автоматически.

---

## 9) Частые проблемы и проверки

### Проверки перед запуском:

- ✅ Зависимости установлены: `npm install`
- ✅ База данных создана и миграции применены
- ✅ `.env` файл создан с корректными креденшелами
- ✅ В dev: `PORT=3001 npm run dev` (сервер на 3001, Vite на 5174)
- ✅ В проде: `npm start` (собирает `dist/` и запускает сервер)

### Типичные проблемы:

- **"Cannot GET /"** — либо не собран `dist/` (запусти `npm run build`), либо сервер не запущен
- **Ошибка подключения к БД** — проверь креденшелы в `.env` и что PostgreSQL запущен
- **Порт занят** — измени `PORT` в `.env` или убей процесс на порту
- **API не работает в dev** — проверь что `vite.config.js` проксирует `/api` на правильный порт сервера

Если что-то не открывается извне — проверьте firewall/ufw/iptables и настройки nginx.

---

## 10) Быстрый старт (чеклист)

```bash
# 1) Установка зависимостей
npm install

# 2) Настройка окружения
cp .env.example .env  # если есть пример
# Отредактируй .env (БД, порты)

# 3) Создание БД и миграции
createdb your_database_name
psql -d your_database_name -f migrations/001_initial_setup.sql
# ... остальные миграции

# 4) Dev режим
PORT=3001 npm run dev

# 5) Продакшен
npm start
```

Готово! Теперь любой новый проект можно поднимать с тем же стеком и процессами.
